function Croppa(t){var e;if(this.defaults={image_url:null,container:null,container_size:[200,200],crop_box_size:[100,100],crop_box_resize:!1,show_zoomer:!1,cross_origin:!1},this.settings=jQuery.extend(this.defaults,t),this.callbacks={error:[],load:[]},!this.settings.image_url)throw(e=new Error("Please add an image url or base64 string or JS Image Instance")).code=1,e.type="croppa",this.fire("error",e),e;if(!Array.isArray(this.settings.crop_box_size)||2!==this.settings.crop_box_size.length)throw(e=new Error("Please add a crop box size")).code=2,e.type="croppa",this.fire("error",e),e;if(!this.settings.container)throw(e=new Error("Please add a container")).code=3,e.type="croppa",this.fire("error",e),e;if(this.container={},this.settings.container instanceof jQuery)this.container.el=this.settings.container,this.settings.container=this.container.el.selector;else if(this.container.el=jQuery(this.settings.container),!this.container.el.length)throw(e=new Error("Container not found.")).code=4,e.type="croppa",this.fire("error",e),e;if(!Array.isArray(this.settings.container_size)||2!==this.settings.container_size.length)throw(e=new Error("Please add a container size")).code=5,e.type="croppa",this.fire("error",e),e;this.data={orientation:"h",image_width:0,image_height:0,scaled_width:0,scaled_height:0,orig_scaled_width:0,orig_scaled_height:0,angle:0,zoom:1,resize_handler:null,crop_box_x:0,crop_box_y:0,crop_box_x_perc:0,crop_box_y_perc:0,crop_box_width:0,crop_box_height:0,crop_box_width_perc:0,crop_box_height_perc:0,crop_box_orig_width:0,crop_box_orig_height:0,crop_box_orig_width_perc:0,crop_box_orig_height_perc:0},this.drag_object={},this.resize_object={top:0,left:0},this.init()}Image.prototype.getOrientation=function(){return!!this.width&&(!!this.height&&(this.width>this.height?"landscape":this.width<this.height?"portrait":"even"))},Croppa.prototype.on=function(t,e,o){if(!this.callbacks.hasOwnProperty(t))return!1;this.callbacks[t].push({callback:e,data:o||null})},Croppa.prototype.fire=function(t,e){if(!this.callbacks.hasOwnProperty(t))return!1;this.callbacks[t].map(function(t){t.callback(e,t.data)})},Croppa.prototype.init=function(){var t=this;this.settings.image_url instanceof Image?(this.image=this.settings.image_url,this.settings.cross_origin&&(this.image.crossOrigin="anonymous"),t.initImageLoad(this.image)):(this.image=new Image,this.settings.cross_origin&&(this.image.crossOrigin="anonymous"),this.image.onload=function(e){t.initImageLoad(this)},this.image.src=this.settings.image_url)},Croppa.prototype.initImageLoad=function(t){var e;(this.data.crop_box_width=this.settings.crop_box_size[0],this.data.crop_box_height=this.settings.crop_box_size[1],this.data.crop_box_orig_width=this.settings.crop_box_size[0],this.data.crop_box_orig_height=this.settings.crop_box_size[1],this.data.crop_box_width>t.width)&&((e=new Error("Crop box width must be smaller than the image width")).code=6,e.type="croppa",e.container=this.container.el,this.fire("error",e));this.data.crop_box_height>t.height&&((e=new Error("Crop box height must be smaller than the image height")).code=7,e.type="croppa",e.container=this.container.el,this.fire("error",e));var o=t.width,r=t.height,i=1.5*this.data.crop_box_width,a=1.5*this.data.crop_box_height;if(t.width>this.data.crop_box_width&&t.height>this.data.crop_box_height){for(;o>i&&r>a;)o/=1.1,r/=1.1;(o<i||r<a)&&(o*=1.1,r*=1.1)}else this.data.crop_box_width>o&&(o=this.data.crop_box_width),this.data.crop_box_height>r&&(r=this.data.crop_box_height);this.decrease_image_size(o,r)},Croppa.prototype.decrease_image_size=function(t,e){var o=this,r=document.createElement("canvas"),i=r.getContext("2d");r.width=t,r.height=e,this.draw(this.image,r,i,t,e,0,1);var a=r.toDataURL("image/jpeg",1);this.image.onload=null,this.image=new Image,this.settings.cross_origin&&(this.image.crossOrigin="anonymous"),this.image.onload=function(t){o.start()},this.image.src=a},Croppa.prototype.start=function(){this.data.image_width=this.image.width,this.data.image_height=this.image.height,this.data.crop_box_width_perc=100*this.settings.crop_box_size[0]/this.data.image_width,this.data.crop_box_height_perc=100*this.settings.crop_box_size[1]/this.data.image_height,this.data.crop_box_orig_width_perc=this.data.crop_box_width_perc,this.data.crop_box_orig_height_perc=this.data.crop_box_height_perc,this.prepare_container(),this.create_canvas(),this.calculate_dims(),this.create_overlay(),this.calculate_overlay_dims(),this.create_crop_box(),this.settings.crop_box_resize&&(this.crop_box_resize_bottom_right(),this.crop_box_resize_bottom_left(),this.crop_box_resize_top_right(),this.crop_box_resize_top_left(),this.crop_box_resize_top(),this.crop_box_resize_bottom(),this.crop_box_resize_left(),this.crop_box_resize_right()),this.resize_listener(),this.drag_listener(),this.draw(this.image,this.canvas,this.ctx,this.data.scaled_width,this.data.scaled_height,this.data.angle,this.data.zoom),this.create_zoomer(),this.fire("load",this)},Croppa.prototype.prepare_container=function(){this.container.id="croppa-"+(new Date).getTime(),this.container.el.append('<div id="'+this.container.id+'" class="croppa-container"></div>'),this.container.parent=this.container.el,this.container.el=jQuery("#"+this.container.id),this.container.parent.addClass("croppa-parent")},Croppa.prototype.create_canvas=function(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.container.el.append('<div class="croppa-inner-container"></div>'),this.container.el.find(".croppa-inner-container").append(this.canvas)},Croppa.prototype.calculate_dims=function(){var t=this.settings.container_size[0],e=this.settings.container_size[1],o=0,r=this.data.image_width,i=this.data.image_height,a=r,s=i;this.container.parent.width()<t&&(t=this.container.parent.width()),r>t&&(a=t,s=i*(o=t/r),i*=o,r*=o),i>e&&"portrait"===this.image.getOrientation()&&(s=e,a=r*(o=e/i),r*=o),this.canvas.width=a,this.canvas.height=s,this.data.scaled_width=a,this.data.scaled_height=s,this.container.el.find(".croppa-illusion-container").width(t),this.container.el.find(".croppa-illusion-container").height(e),"v"===this.data.orientation?(this.canvas.width=s,this.canvas.height=a):(this.data.orig_scaled_width=a,this.data.orig_scaled_height=s)},Croppa.prototype.create_overlay=function(){this.overlay={},this.container.el.find(".croppa-inner-container").append('<div class="croppa-overlay"></div>'),this.overlay.el=this.container.el.find(".croppa-overlay")},Croppa.prototype.calculate_overlay_dims=function(){var t=this.canvas.getBoundingClientRect(),e=t.width,o=t.height;this.data.crop_box_width=e*this.data.crop_box_width_perc/100,this.data.crop_box_height=o*this.data.crop_box_height_perc/100,this.data.crop_box_orig_width=e*this.data.crop_box_orig_width_perc/100,this.data.crop_box_orig_height=o*this.data.crop_box_orig_height_perc/100,this.data.crop_box_x=e*this.data.crop_box_x_perc/100,this.data.crop_box_y=o*this.data.crop_box_y_perc/100,this.overlay.el.css({width:this.data.crop_box_width+"px",height:this.data.crop_box_height+"px",left:this.data.crop_box_x+"px",top:this.data.crop_box_y+"px"})},Croppa.prototype.create_crop_box=function(){this.container.el.append('<div class="croppa-crop-box-parent"><div class="croppa-crop-box"></div></div>'),this.cropbox={},this.cropbox.parent=this.container.el.find(".croppa-crop-box-parent"),this.cropbox.el=this.container.el.find(".croppa-crop-box");var t=this.canvas.getBoundingClientRect();this.cropbox.parent.css({width:t.width+"px",height:t.height+"px"}),this.cropbox.el.css({width:this.data.crop_box_width+"px",height:this.data.crop_box_height+"px",left:this.data.crop_box_x+"px",top:this.data.crop_box_y+"px"}),this.settings.crop_box_resize&&(this.cropbox.el.append('<div class="croppa-resizer-top"></div><div class="croppa-resizer-right"></div><div class="croppa-resizer-bottom"></div><div class="croppa-resizer-left"></div><div class="croppa-resizer-tl"></div><div class="croppa-resizer-tr"></div><div class="croppa-resizer-bl"></div><div class="croppa-resizer-br"></div>'),this.resizer={},this.resizer.els={},this.resizer.els.tl=this.cropbox.el.find(".croppa-resizer-tl"),this.resizer.els.tr=this.cropbox.el.find(".croppa-resizer-tr"),this.resizer.els.bl=this.cropbox.el.find(".croppa-resizer-bl"),this.resizer.els.br=this.cropbox.el.find(".croppa-resizer-br"),this.resizer.els.top=this.cropbox.el.find(".croppa-resizer-top"),this.resizer.els.right=this.cropbox.el.find(".croppa-resizer-right"),this.resizer.els.bottom=this.cropbox.el.find(".croppa-resizer-bottom"),this.resizer.els.left=this.cropbox.el.find(".croppa-resizer-left"))},Croppa.prototype.update_crop_box=function(){var t=this.canvas.getBoundingClientRect();this.cropbox.parent.css({width:t.width+"px",height:t.height+"px"}),this.cropbox.el.css({width:this.data.crop_box_width+"px",height:this.data.crop_box_height+"px",left:this.data.crop_box_x+"px",top:this.data.crop_box_y+"px"})},Croppa.prototype.draw=function(t,e,o,r,i,a,s){var c=e.width,n=e.height;o.clearRect(0,0,c,n),o.save(),o.translate(c/2,n/2),o.rotate(a*Math.PI/180),o.scale(s,s),o.translate(-c/2,-n/2),o.drawImage(t,c/2-r/2,n/2-i/2,r,i),o.restore()},Croppa.prototype.crop=function(t,e,o,r){var i=document.createElement("canvas"),a=i.getContext("2d");i.width=this.data.image_width,i.height=this.data.image_height,"v"===this.data.orientation&&(i.width=this.data.image_height,i.height=this.data.image_width),this.draw(this.image,i,a,this.data.image_width,this.data.image_height,this.data.angle,this.data.zoom);var s=a.getImageData(t,e,o,r),c=document.createElement("canvas"),n=c.getContext("2d");c.width=o,c.height=r,n.putImageData(s,0,0);var d=c.toDataURL("image/jpeg",1);return delete i,delete c,delete a,delete n,delete s,d},Croppa.prototype.result=function(){var t=this.data.image_width,e=this.data.image_height,o=this.data.crop_box_width_perc*t/100,r=this.data.crop_box_height_perc*e/100;"v"===this.data.orientation&&(t=this.data.image_height,e=this.data.image_width,o=this.data.crop_box_width_perc*this.data.image_height/100,r=this.data.crop_box_height_perc*this.data.image_width/100);var i=this.data.crop_box_x_perc*t/100,a=this.data.crop_box_y_perc*e/100;return this.crop(i,a,o,r)},Croppa.prototype.zoom=function(t){if(t<.1)return!1;this.draw(this.image,this.canvas,this.ctx,this.data.scaled_width,this.data.scaled_height,this.data.angle,t),this.data.zoom=t},Croppa.prototype.zoom_in=function(){this.zoom(this.data.zoom+.1)},Croppa.prototype.zoom_out=function(){this.zoom(this.data.zoom-.1)},Croppa.prototype.update_overlay_dims_before_rotating=function(){var t=this.canvas.getBoundingClientRect(),e=this.overlay.el.get(0),o=e.getBoundingClientRect(),r=parseFloat(e.style.top)||0,i=parseFloat(e.style.left)||0;o.x+o.width>t.x+t.width&&(e.style.left="0px",i=0,o.width>t.width&&(e.style.width=t.width+"px")),o.y+o.height>t.y+t.height&&(e.style.top="0px",r=0,o.height>t.height&&(e.style.height=t.height+"px")),this.data.crop_box_width=parseFloat(e.style.width),this.data.crop_box_height=parseFloat(e.style.height),this.data.crop_box_orig_width=this.data.crop_box_width,this.data.crop_box_orig_height=this.data.crop_box_height,this.data.crop_box_width_perc=100*this.data.crop_box_width/t.width,this.data.crop_box_height_perc=100*this.data.crop_box_height/t.height,this.data.crop_box_orig_width_perc=this.data.crop_box_width_perc,this.data.crop_box_orig_height_perc=this.data.crop_box_height_perc,this.data.crop_box_x=i,this.data.crop_box_y=r,this.data.crop_box_x_perc=100*i/t.width,this.data.crop_box_y_perc=100*r/t.height},Croppa.prototype.rotate=function(t){t=parseInt(t),Math.abs(t)/90%2==1?this.data.orientation="v":this.data.orientation="h",this.calculate_dims(),this.update_overlay_dims_before_rotating(),this.draw(this.image,this.canvas,this.ctx,this.data.scaled_width,this.data.scaled_height,t,this.data.zoom),this.data.angle=t,this.update_crop_box()},Croppa.prototype.rotate_left=function(){this.rotate(this.data.angle-90)},Croppa.prototype.rotate_right=function(){this.rotate(this.data.angle+90)},Croppa.prototype.create_zoomer=function(){if(!this.settings.show_zoomer)return!1;var t=this;this.zoomer={},this.zoomer.id=this.container.id+"-zoomer",this.container.el.after('<input id="'+this.zoomer.id+'" class="croppa-slider" type="range" step="0.01" min="0.5" max="5" value="1">'),this.zoomer.el=jQuery("#"+this.zoomer.id),this.zoomer.el.on("input",function(e){t.zoom(t.zoomer.el.val())})},Croppa.prototype.resize_listener=function(){var t,e=this;this.data.resize_handler=function(){clearTimeout(t),t=setTimeout(function(){e.calculate_dims(),e.calculate_overlay_dims(),e.draw(e.image,e.canvas,e.ctx,e.data.scaled_width,e.data.scaled_height,e.data.angle,e.data.zoom),e.update_crop_box()},20)},jQuery(window).on("resize",this.data.resize_handler)},Croppa.prototype.drag_listener=function(){var t=this,e=this.cropbox.el.get(0),o=this.overlay.el.get(0);this.drag_object.active=!1,this.drag_object.drag_start=function(o){if(o.target!==e)return!1;var r,i;o.stopPropagation(),o.preventDefault(),t.drag_object.active=!0,"ontouchstart"in document.documentElement?(document.addEventListener("touchend",t.drag_object.drag_end,{capture:!1,passive:!1}),document.addEventListener("touchmove",t.drag_object.drag,{passive:!1})):(document.addEventListener("mouseup",t.drag_object.drag_end,{capture:!1,passive:!1}),document.addEventListener("mousemove",t.drag_object.drag,{capture:!1,passive:!1})),"touchstart"===o.type?(r=o.touches[0].clientX,i=o.touches[0].clientY):(r=o.clientX,i=o.clientY);var a=t.canvas.getBoundingClientRect(),s=e.getBoundingClientRect();t.drag_object.minBoundX=a.x,t.drag_object.minBoundY=a.y,t.drag_object.maxBoundX=t.drag_object.minBoundX+a.width-s.width,t.drag_object.maxBoundY=t.drag_object.minBoundY+a.height-s.height,t.drag_object.posX=r-s.x,t.drag_object.posY=i-s.y,t.drag_object.parentWidth=a.width,t.drag_object.parentHeight=a.height},this.drag_object.drag=function(r){if(r.stopPropagation(),r.preventDefault(),!t.drag_object.active)return!1;var i,a;"touchmove"===r.type?(i=r.touches[0].clientX,a=r.touches[0].clientY):(i=r.clientX,a=r.clientY);var s=Math.max(t.drag_object.minBoundX,Math.min(i-t.drag_object.posX,t.drag_object.maxBoundX)),c=Math.max(t.drag_object.minBoundY,Math.min(a-t.drag_object.posY,t.drag_object.maxBoundY)),n=s-t.drag_object.minBoundX,d=c-t.drag_object.minBoundY;e.style.left=n+"px",e.style.top=d+"px",o.style.left=n+"px",o.style.top=d+"px",t.data.crop_box_x=n,t.data.crop_box_y=d;var h=100*n/t.drag_object.parentWidth,_=100*d/t.drag_object.parentHeight;t.data.crop_box_x_perc=h,t.data.crop_box_y_perc=_},this.drag_object.drag_end=function(e){e.stopPropagation(),e.preventDefault(),t.drag_object.active=!1,"ontouchstart"in document.documentElement?(document.removeEventListener("touchend",t.drag_object.drag_end,{capture:!1,passive:!1}),document.removeEventListener("touchmove",t.drag_object.drag,{capture:!1,passive:!1})):(document.removeEventListener("mouseup",t.drag_object.drag_end,{capture:!1,passive:!1}),document.removeEventListener("mousemove",t.drag_object.drag,{capture:!1,passive:!1})),document.querySelector("body").classList.remove("no-scroll")},"ontouchstart"in document.documentElement?document.addEventListener("touchstart",this.drag_object.drag_start,{capture:!1,passive:!1}):document.addEventListener("mousedown",this.drag_object.drag_start,{capture:!1,passive:!1})},Croppa.prototype.calculate_min_crop_box_size=function(){var t=this.data.crop_box_orig_width,e=this.data.crop_box_orig_height,o=0,r=0;if(t>e)for(o=e,r=t;o>0;)o-=1,r-=1;else if(e>t)for(o=e,r=t;r>0;)o-=1,r-=1;else for(o=e,r=t;r>0;)o-=1,r-=1;return[r,o]},Croppa.prototype.crop_box_resize_bottom_right=function(){var t=this,e=this.cropbox.el.get(0),o=this.overlay.el.get(0),r=this.resizer.els.br;this.resize_object.active=!1,this.resize_object.br_drag_start=function(e){if(e.target!==r.get(0))return!1;var o,i;e.stopPropagation(),e.preventDefault(),t.resize_object.active=!0,"ontouchstart"in document.documentElement?(document.removeEventListener("touchstart",t.drag_object.drag_start,{capture:!1,passive:!1}),document.addEventListener("touchmove",t.resize_object.br_drag,{capture:!1,passive:!1}),document.addEventListener("touchend",t.resize_object.br_drag_end,{capture:!1,passive:!1})):(document.removeEventListener("mousedown",t.drag_object.drag_start,{capture:!1,passive:!1}),document.addEventListener("mousemove",t.resize_object.br_drag,{capture:!1,passive:!1}),document.addEventListener("mouseup",t.resize_object.br_drag_end,{capture:!1,passive:!1})),"touchstart"===e.type?(o=e.touches[0].clientX,i=e.touches[0].clientY):(o=e.clientX,i=e.clientY),t.resize_object.posX=o,t.resize_object.posY=i;var a=t.canvas.getBoundingClientRect(),s=t.overlay.el.get(0).getBoundingClientRect(),c=a.y+a.height-(s.y+s.height),n=a.x+a.width-(s.x+s.width);t.resize_object.maxWidth=s.width+n,t.resize_object.maxHeight=s.height+c},this.resize_object.br_drag=function(r){if(!t.resize_object.active)return!1;var i,a;r.stopPropagation(),r.preventDefault(),"touchmove"===r.type?(i=r.touches[0].clientX,a=r.touches[0].clientY):(i=r.clientX,a=r.clientY);var s=i-t.resize_object.posX,c=a-t.resize_object.posY,n=t.data.crop_box_width+s,d=t.data.crop_box_height+c,h=Math.max(2,Math.min(n,t.resize_object.maxWidth)),_=Math.max(2,Math.min(d,t.resize_object.maxHeight));e.style.width=h+"px",e.style.height=_+"px",o.style.width=e.style.width,o.style.height=e.style.height},this.resize_object.br_drag_end=function(o){o.stopPropagation(),o.preventDefault();var r=t.canvas.getBoundingClientRect();t.resize_object.active=!1,t.data.crop_box_width=parseFloat(e.style.width),t.data.crop_box_height=parseFloat(e.style.height),t.data.crop_box_width_perc=100*t.data.crop_box_width/r.width,t.data.crop_box_height_perc=100*t.data.crop_box_height/r.height;var i=parseFloat(e.style.top)||0,a=parseFloat(e.style.left)||0;t.data.crop_box_x=a,t.data.crop_box_y=i,t.data.crop_box_x_perc=100*a/r.width,t.data.crop_box_y_perc=100*i/r.height,"ontouchstart"in document.documentElement?(document.removeEventListener("touchend",t.resize_object.br_drag_end,{capture:!1,passive:!1}),document.removeEventListener("touchmove",t.resize_object.br_drag,{capture:!1,passive:!1}),document.addEventListener("touchstart",t.drag_object.drag_start,{capture:!1,passive:!1})):(document.removeEventListener("mouseup",t.resize_object.br_drag_end,{capture:!1,passive:!1}),document.removeEventListener("mousemove",t.resize_object.br_drag,{capture:!1,passive:!1}),document.addEventListener("mousedown",t.drag_object.drag_start,{capture:!1,passive:!1}))},"ontouchstart"in document.documentElement?document.addEventListener("touchstart",this.resize_object.br_drag_start,{capture:!1,passive:!1}):document.addEventListener("mousedown",this.resize_object.br_drag_start,{capture:!1,passive:!1})},Croppa.prototype.crop_box_resize_bottom_left=function(){var t=this,e=this.cropbox.el.get(0),o=this.overlay.el.get(0),r=this.resizer.els.bl;this.resize_object.active=!1,this.resize_object.bl_drag_start=function(o){if(o.target!==r.get(0))return!1;var i,a;o.stopPropagation(),o.preventDefault(),t.resize_object.active=!0,"ontouchstart"in document.documentElement?(document.removeEventListener("touchstart",t.drag_object.drag_start,{capture:!1,passive:!1}),document.addEventListener("touchmove",t.resize_object.bl_drag,{capture:!1,passive:!1}),document.addEventListener("touchend",t.resize_object.bl_drag_end,{capture:!1,passive:!1})):(document.removeEventListener("mousedown",t.drag_object.drag_start,{capture:!1,passive:!1}),document.addEventListener("mousemove",t.resize_object.bl_drag,{capture:!1,passive:!1}),document.addEventListener("mouseup",t.resize_object.bl_drag_end,{capture:!1,passive:!1})),"touchstart"===o.type?(i=o.touches[0].clientX,a=o.touches[0].clientY):(i=o.clientX,a=o.clientY),t.resize_object.posX=i,t.resize_object.posY=a,t.resize_object.left=parseFloat(e.style.left||0);var s=t.canvas.getBoundingClientRect(),c=t.overlay.el.get(0).getBoundingClientRect();height_diff=s.y+s.height-(c.y+c.height),width_diff=c.x-s.x,diff=height_diff,height_diff>width_diff&&(diff=width_diff),t.resize_object.maxWidth=c.width+width_diff,t.resize_object.maxHeight=c.height+height_diff},this.resize_object.bl_drag=function(r){if(!t.resize_object.active)return!1;var i,a;r.stopPropagation(),r.preventDefault(),"touchmove"===r.type?(i=r.touches[0].clientX,a=r.touches[0].clientY):(i=r.clientX,a=r.clientY);var s=-1*(i-t.resize_object.posX),c=a-t.resize_object.posY,n=t.data.crop_box_width+s,d=t.data.crop_box_height+c,h=Math.max(2,Math.min(n,t.resize_object.maxWidth)),_=Math.max(2,Math.min(d,t.resize_object.maxHeight));e.style.width=h+"px",e.style.height=_+"px",o.style.width=e.style.width,o.style.height=e.style.height,e.style.left=t.resize_object.left-(h-t.data.crop_box_width)+"px",o.style.left=e.style.left},this.resize_object.bl_drag_end=function(o){o.stopPropagation(),o.preventDefault();var r=t.canvas.getBoundingClientRect();t.resize_object.active=!1,t.data.crop_box_width=parseFloat(e.style.width),t.data.crop_box_height=parseFloat(e.style.height),t.data.crop_box_width_perc=100*t.data.crop_box_width/r.width,t.data.crop_box_height_perc=100*t.data.crop_box_height/r.height;var i=parseFloat(e.style.top)||0,a=parseFloat(e.style.left)||0;t.data.crop_box_x_perc=100*a/r.width,t.data.crop_box_y_perc=100*i/r.height,"ontouchstart"in document.documentElement?(document.removeEventListener("touchend",t.resize_object.bl_drag_end,{capture:!1,passive:!1}),document.removeEventListener("touchmove",t.resize_object.bl_drag,{capture:!1,passive:!1}),document.addEventListener("touchstart",t.drag_object.drag_start,{capture:!1,passive:!1})):(document.removeEventListener("mouseup",t.resize_object.bl_drag_end,{capture:!1,passive:!1}),document.removeEventListener("mousemove",t.resize_object.bl_drag,{capture:!1,passive:!1}),document.addEventListener("mousedown",t.drag_object.drag_start,{capture:!1,passive:!1}))},"ontouchstart"in document.documentElement?document.addEventListener("touchstart",this.resize_object.bl_drag_start,{capture:!1,passive:!1}):document.addEventListener("mousedown",this.resize_object.bl_drag_start,{capture:!1,passive:!1})},Croppa.prototype.crop_box_resize_top_right=function(){var t=this,e=this.cropbox.el.get(0),o=this.overlay.el.get(0),r=this.resizer.els.tr;this.resize_object.active=!1,this.resize_object.tr_drag_start=function(o){if(o.target!==r.get(0))return!1;var i,a;o.stopPropagation(),o.preventDefault(),t.resize_object.active=!0,"ontouchstart"in document.documentElement?(document.removeEventListener("touchstart",t.drag_object.drag_start,{capture:!1,passive:!1}),document.addEventListener("touchmove",t.resize_object.tr_drag,{capture:!1,passive:!1}),document.addEventListener("touchend",t.resize_object.tr_drag_end,{capture:!1,passive:!1})):(document.removeEventListener("mousedown",t.drag_object.drag_start,{capture:!1,passive:!1}),document.addEventListener("mousemove",t.resize_object.tr_drag,{capture:!1,passive:!1}),document.addEventListener("mouseup",t.resize_object.tr_drag_end,{capture:!1,passive:!1})),"touchstart"===o.type?(i=o.touches[0].clientX,a=o.touches[0].clientY):(i=o.clientX,a=o.clientY),t.resize_object.posX=i,t.resize_object.posY=a,t.resize_object.top=parseFloat(e.style.top||0);var s=t.canvas.getBoundingClientRect(),c=t.overlay.el.get(0).getBoundingClientRect(),n=c.y-s.y,d=s.x+s.width-(c.x+c.width);t.resize_object.maxWidth=c.width+d,t.resize_object.maxHeight=c.height+n},this.resize_object.tr_drag=function(r){if(!t.resize_object.active)return!1;var i,a;r.stopPropagation(),r.preventDefault(),"touchmove"===r.type?(i=r.touches[0].clientX,a=r.touches[0].clientY):(i=r.clientX,a=r.clientY);var s=i-t.resize_object.posX,c=-1*(a-t.resize_object.posY),n=t.data.crop_box_width+s,d=t.data.crop_box_height+c,h=Math.max(2,Math.min(n,t.resize_object.maxWidth)),_=Math.max(2,Math.min(d,t.resize_object.maxHeight));e.style.width=h+"px",e.style.height=_+"px",o.style.width=e.style.width,o.style.height=e.style.height,e.style.top=t.resize_object.top-(_-t.data.crop_box_height)+"px",o.style.top=e.style.top},this.resize_object.tr_drag_end=function(o){o.stopPropagation(),o.preventDefault();var r=t.canvas.getBoundingClientRect();t.resize_object.active=!1,t.data.crop_box_width=parseFloat(e.style.width),t.data.crop_box_height=parseFloat(e.style.height),t.data.crop_box_width_perc=100*t.data.crop_box_width/r.width,t.data.crop_box_height_perc=100*t.data.crop_box_height/r.height;var i=parseFloat(e.style.top)||0,a=parseFloat(e.style.left)||0;t.data.crop_box_x_perc=100*a/r.width,t.data.crop_box_y_perc=100*i/r.height,"ontouchstart"in document.documentElement?(document.removeEventListener("touchend",t.resize_object.tr_drag_end,{capture:!1,passive:!1}),document.removeEventListener("touchmove",t.resize_object.tr_drag,{capture:!1,passive:!1}),document.addEventListener("touchstart",t.drag_object.drag_start,{capture:!1,passive:!1})):(document.removeEventListener("mouseup",t.resize_object.tr_drag_end,{capture:!1,passive:!1}),document.removeEventListener("mousemove",t.resize_object.tr_drag,{capture:!1,passive:!1}),document.addEventListener("mousedown",t.drag_object.drag_start,{capture:!1,passive:!1}))},"ontouchstart"in document.documentElement?document.addEventListener("touchstart",this.resize_object.tr_drag_start,{capture:!1,passive:!1}):document.addEventListener("mousedown",this.resize_object.tr_drag_start,{capture:!1,passive:!1})},Croppa.prototype.crop_box_resize_top_left=function(){var t=this,e=this.cropbox.el.get(0),o=this.overlay.el.get(0),r=this.resizer.els.tl;this.resize_object.active=!1,this.resize_object.tl_drag_start=function(o){if(o.target!==r.get(0))return!1;var i,a;o.stopPropagation(),o.preventDefault(),t.resize_object.active=!0,"ontouchstart"in document.documentElement?(document.removeEventListener("touchstart",t.drag_object.drag_start,{capture:!1,passive:!1}),document.addEventListener("touchmove",t.resize_object.tl_drag,{capture:!1,passive:!1}),document.addEventListener("touchend",t.resize_object.tl_drag_end,{capture:!1,passive:!1})):(document.removeEventListener("mousedown",t.drag_object.drag_start,{capture:!1,passive:!1}),document.addEventListener("mousemove",t.resize_object.tl_drag,{capture:!1,passive:!1}),document.addEventListener("mouseup",t.resize_object.tl_drag_end,{capture:!1,passive:!1})),"touchstart"===o.type?(i=o.touches[0].clientX,a=o.touches[0].clientY):(i=o.clientX,a=o.clientY),t.resize_object.posX=i,t.resize_object.posY=a,t.resize_object.top=parseFloat(e.style.top||0),t.resize_object.left=parseFloat(e.style.left||0);var s=t.canvas.getBoundingClientRect(),c=t.overlay.el.get(0).getBoundingClientRect(),n=c.y-s.y,d=c.x-s.x;t.resize_object.maxWidth=c.width+d,t.resize_object.maxHeight=c.height+n},this.resize_object.tl_drag=function(r){if(!t.resize_object.active)return!1;var i,a;r.stopPropagation(),r.preventDefault(),"touchmove"===r.type?(i=r.touches[0].clientX,a=r.touches[0].clientY):(i=r.clientX,a=r.clientY);var s=-1*(i-t.resize_object.posX),c=-1*(a-t.resize_object.posY),n=t.data.crop_box_width+s,d=t.data.crop_box_height+c,h=Math.max(2,Math.min(n,t.resize_object.maxWidth)),_=Math.max(2,Math.min(d,t.resize_object.maxHeight));e.style.width=h+"px",e.style.height=_+"px",o.style.width=e.style.width,o.style.height=e.style.height,e.style.top=t.resize_object.top-(_-t.data.crop_box_height)+"px",e.style.left=t.resize_object.left-(h-t.data.crop_box_width)+"px",o.style.top=e.style.top,o.style.left=e.style.left},this.resize_object.tl_drag_end=function(o){o.stopPropagation(),o.preventDefault();var r=t.canvas.getBoundingClientRect();t.resize_object.active=!1,t.data.crop_box_width=parseFloat(e.style.width),t.data.crop_box_height=parseFloat(e.style.height),t.data.crop_box_width_perc=100*t.data.crop_box_width/r.width,t.data.crop_box_height_perc=100*t.data.crop_box_height/r.height;var i=parseFloat(e.style.top)||0,a=parseFloat(e.style.left)||0;t.data.crop_box_x_perc=100*a/r.width,t.data.crop_box_y_perc=100*i/r.height,"ontouchstart"in document.documentElement?(document.removeEventListener("touchend",t.resize_object.tl_drag_end,{capture:!1,passive:!1}),document.removeEventListener("touchmove",t.resize_object.tl_drag,{capture:!1,passive:!1}),document.addEventListener("touchstart",t.drag_object.drag_start,{capture:!1,passive:!1})):(document.removeEventListener("mouseup",t.resize_object.tl_drag_end,{capture:!1,passive:!1}),document.removeEventListener("mousemove",t.resize_object.tl_drag,{capture:!1,passive:!1}),document.addEventListener("mousedown",t.drag_object.drag_start,{capture:!1,passive:!1}))},"ontouchstart"in document.documentElement?document.addEventListener("touchstart",this.resize_object.tl_drag_start,{capture:!1,passive:!1}):document.addEventListener("mousedown",this.resize_object.tl_drag_start,{capture:!1,passive:!1})},Croppa.prototype.crop_box_resize_right=function(){var t=this,e=this.cropbox.el.get(0),o=this.overlay.el.get(0),r=this.resizer.els.right;this.resize_object.active=!1,this.resize_object.right_drag_start=function(e){if(e.target!==r.get(0))return!1;var o,i;e.stopPropagation(),e.preventDefault(),t.resize_object.active=!0,"ontouchstart"in document.documentElement?(document.removeEventListener("touchstart",t.drag_object.drag_start,{capture:!1,passive:!1}),document.addEventListener("touchmove",t.resize_object.right_drag,{capture:!1,passive:!1}),document.addEventListener("touchend",t.resize_object.right_drag_end,{capture:!1,passive:!1})):(document.removeEventListener("mousedown",t.drag_object.drag_start,{capture:!1,passive:!1}),document.addEventListener("mousemove",t.resize_object.right_drag,{capture:!1,passive:!1}),document.addEventListener("mouseup",t.resize_object.right_drag_end,{capture:!1,passive:!1})),"touchstart"===e.type?(o=e.touches[0].clientX,i=e.touches[0].clientY):(o=e.clientX,i=e.clientY),t.resize_object.posX=o,t.resize_object.posY=i;var a=t.canvas.getBoundingClientRect(),s=t.overlay.el.get(0).getBoundingClientRect(),c=a.x+a.width-(s.x+s.width);t.resize_object.maxWidth=s.width+c},this.resize_object.right_drag=function(r){if(!t.resize_object.active)return!1;var i;r.stopPropagation(),r.preventDefault(),"touchmove"===r.type?(i=r.touches[0].clientX,r.touches[0].clientY):(i=r.clientX,r.clientY);var a=i-t.resize_object.posX,s=t.data.crop_box_width+a,c=Math.max(2,Math.min(s,t.resize_object.maxWidth));e.style.width=c+"px",o.style.width=e.style.width},this.resize_object.right_drag_end=function(o){o.stopPropagation(),o.preventDefault();var r=t.canvas.getBoundingClientRect();t.resize_object.active=!1,t.data.crop_box_width=parseFloat(e.style.width),t.data.crop_box_height=parseFloat(e.style.height),t.data.crop_box_width_perc=100*t.data.crop_box_width/r.width,t.data.crop_box_height_perc=100*t.data.crop_box_height/r.height;var i=parseFloat(e.style.top)||0,a=parseFloat(e.style.left)||0;t.data.crop_box_x=a,t.data.crop_box_y=i,t.data.crop_box_x_perc=100*a/r.width,t.data.crop_box_y_perc=100*i/r.height,"ontouchstart"in document.documentElement?(document.removeEventListener("touchend",t.resize_object.right_drag_end,{capture:!1,passive:!1}),document.removeEventListener("touchmove",t.resize_object.right_drag,{capture:!1,passive:!1}),document.addEventListener("touchstart",t.drag_object.drag_start,{capture:!1,passive:!1})):(document.removeEventListener("mouseup",t.resize_object.right_drag_end,{capture:!1,passive:!1}),document.removeEventListener("mousemove",t.resize_object.right_drag,{capture:!1,passive:!1}),document.addEventListener("mousedown",t.drag_object.drag_start,{capture:!1,passive:!1}))},"ontouchstart"in document.documentElement?document.addEventListener("touchstart",this.resize_object.right_drag_start,{capture:!1,passive:!1}):document.addEventListener("mousedown",this.resize_object.right_drag_start,{capture:!1,passive:!1})},Croppa.prototype.crop_box_resize_bottom=function(){var t=this,e=this.cropbox.el.get(0),o=this.overlay.el.get(0),r=this.resizer.els.bottom;this.resize_object.active=!1,this.resize_object.bottom_drag_start=function(e){if(e.target!==r.get(0))return!1;var o,i;e.stopPropagation(),e.preventDefault(),t.resize_object.active=!0,"ontouchstart"in document.documentElement?(document.removeEventListener("touchstart",t.drag_object.drag_start,{capture:!1,passive:!1}),document.addEventListener("touchmove",t.resize_object.bottom_drag,{capture:!1,passive:!1}),document.addEventListener("touchend",t.resize_object.bottom_drag_end,{capture:!1,passive:!1})):(document.removeEventListener("mousedown",t.drag_object.drag_start,{capture:!1,passive:!1}),document.addEventListener("mousemove",t.resize_object.bottom_drag,{capture:!1,passive:!1}),document.addEventListener("mouseup",t.resize_object.bottom_drag_end,{capture:!1,passive:!1})),"touchstart"===e.type?(o=e.touches[0].clientX,i=e.touches[0].clientY):(o=e.clientX,i=e.clientY),t.resize_object.posX=o,t.resize_object.posY=i;var a=t.canvas.getBoundingClientRect(),s=t.overlay.el.get(0).getBoundingClientRect(),c=a.y+a.height-(s.y+s.height);t.resize_object.maxHeight=s.height+c},this.resize_object.bottom_drag=function(r){if(!t.resize_object.active)return!1;var i;r.stopPropagation(),r.preventDefault(),"touchmove"===r.type?(r.touches[0].clientX,i=r.touches[0].clientY):(r.clientX,i=r.clientY);var a=i-t.resize_object.posY,s=t.data.crop_box_height+a,c=Math.max(2,Math.min(s,t.resize_object.maxHeight));e.style.height=c+"px",o.style.height=e.style.height},this.resize_object.bottom_drag_end=function(o){o.stopPropagation(),o.preventDefault();var r=t.canvas.getBoundingClientRect();t.resize_object.active=!1,t.data.crop_box_width=parseFloat(e.style.width),t.data.crop_box_height=parseFloat(e.style.height),t.data.crop_box_width_perc=100*t.data.crop_box_width/r.width,t.data.crop_box_height_perc=100*t.data.crop_box_height/r.height;var i=parseFloat(e.style.top)||0,a=parseFloat(e.style.left)||0;t.data.crop_box_x=a,t.data.crop_box_y=i,t.data.crop_box_x_perc=100*a/r.width,t.data.crop_box_y_perc=100*i/r.height,"ontouchstart"in document.documentElement?(document.removeEventListener("touchend",t.resize_object.bottom_drag_end,{capture:!1,passive:!1}),document.removeEventListener("touchmove",t.resize_object.bottom_drag,{capture:!1,passive:!1}),document.addEventListener("touchstart",t.drag_object.drag_start,{capture:!1,passive:!1})):(document.removeEventListener("mouseup",t.resize_object.bottom_drag_end,{capture:!1,passive:!1}),document.removeEventListener("mousemove",t.resize_object.bottom_drag,{capture:!1,passive:!1}),document.addEventListener("mousedown",t.drag_object.drag_start,{capture:!1,passive:!1}))},"ontouchstart"in document.documentElement?document.addEventListener("touchstart",this.resize_object.bottom_drag_start,{capture:!1,passive:!1}):document.addEventListener("mousedown",this.resize_object.bottom_drag_start,{capture:!1,passive:!1})},Croppa.prototype.crop_box_resize_top=function(){var t=this,e=this.cropbox.el.get(0),o=this.overlay.el.get(0),r=this.resizer.els.top;this.resize_object.active=!1,this.resize_object.top_drag_start=function(o){if(o.target!==r.get(0))return!1;var i,a;o.stopPropagation(),o.preventDefault(),t.resize_object.active=!0,"ontouchstart"in document.documentElement?(document.removeEventListener("touchstart",t.drag_object.drag_start,{capture:!1,passive:!1}),document.addEventListener("touchmove",t.resize_object.top_drag,{capture:!1,passive:!1}),document.addEventListener("touchend",t.resize_object.top_drag_end,{capture:!1,passive:!1})):(document.removeEventListener("mousedown",t.drag_object.drag_start,{capture:!1,passive:!1}),document.addEventListener("mousemove",t.resize_object.top_drag,{capture:!1,passive:!1}),document.addEventListener("mouseup",t.resize_object.top_drag_end,{capture:!1,passive:!1})),"touchstart"===o.type?(i=o.touches[0].clientX,a=o.touches[0].clientY):(i=o.clientX,a=o.clientY),t.resize_object.posX=i,t.resize_object.posY=a,t.resize_object.top=parseFloat(e.style.top||0);var s=t.canvas.getBoundingClientRect(),c=t.overlay.el.get(0).getBoundingClientRect(),n=c.y-s.y;t.resize_object.maxHeight=c.height+n},this.resize_object.top_drag=function(r){if(!t.resize_object.active)return!1;var i;r.stopPropagation(),r.preventDefault(),"touchmove"===r.type?(r.touches[0].clientX,i=r.touches[0].clientY):(r.clientX,i=r.clientY);var a=-1*(i-t.resize_object.posY),s=t.data.crop_box_height+a,c=Math.max(2,Math.min(s,t.resize_object.maxHeight));e.style.height=c+"px",o.style.height=e.style.height,e.style.top=t.resize_object.top-(c-t.data.crop_box_height)+"px",o.style.top=e.style.top},this.resize_object.top_drag_end=function(o){o.stopPropagation(),o.preventDefault();var r=t.canvas.getBoundingClientRect();t.resize_object.active=!1,t.data.crop_box_width=parseFloat(e.style.width),t.data.crop_box_height=parseFloat(e.style.height),t.data.crop_box_width_perc=100*t.data.crop_box_width/r.width,t.data.crop_box_height_perc=100*t.data.crop_box_height/r.height;var i=parseFloat(e.style.top)||0,a=parseFloat(e.style.left)||0;t.data.crop_box_x_perc=100*a/r.width,t.data.crop_box_y_perc=100*i/r.height,"ontouchstart"in document.documentElement?(document.removeEventListener("touchend",t.resize_object.top_drag_end,{capture:!1,passive:!1}),document.removeEventListener("touchmove",t.resize_object.top_drag,{capture:!1,passive:!1}),document.addEventListener("touchstart",t.drag_object.drag_start,{capture:!1,passive:!1})):(document.removeEventListener("mouseup",t.resize_object.top_drag_end,{capture:!1,passive:!1}),document.removeEventListener("mousemove",t.resize_object.top_drag,{capture:!1,passive:!1}),document.addEventListener("mousedown",t.drag_object.drag_start,{capture:!1,passive:!1}))},"ontouchstart"in document.documentElement?document.addEventListener("touchstart",this.resize_object.top_drag_start,{capture:!1,passive:!1}):document.addEventListener("mousedown",this.resize_object.top_drag_start,{capture:!1,passive:!1})},Croppa.prototype.crop_box_resize_left=function(){var t=this,e=this.cropbox.el.get(0),o=this.overlay.el.get(0),r=this.resizer.els.left;this.resize_object.active=!1,this.resize_object.left_drag_start=function(o){if(o.target!==r.get(0))return!1;var i,a;o.stopPropagation(),o.preventDefault(),t.resize_object.active=!0,"ontouchstart"in document.documentElement?(document.removeEventListener("touchstart",t.drag_object.drag_start,{capture:!1,passive:!1}),document.addEventListener("touchmove",t.resize_object.left_drag,{capture:!1,passive:!1}),document.addEventListener("touchend",t.resize_object.left_drag_end,{capture:!1,passive:!1})):(document.removeEventListener("mousedown",t.drag_object.drag_start,{capture:!1,passive:!1}),document.addEventListener("mousemove",t.resize_object.left_drag,{capture:!1,passive:!1}),document.addEventListener("mouseup",t.resize_object.left_drag_end,{capture:!1,passive:!1})),"touchstart"===o.type?(i=o.touches[0].clientX,a=o.touches[0].clientY):(i=o.clientX,a=o.clientY),t.resize_object.posX=i,t.resize_object.posY=a,t.resize_object.top=parseFloat(e.style.top||0),t.resize_object.left=parseFloat(e.style.left||0);var s=t.canvas.getBoundingClientRect(),c=t.overlay.el.get(0).getBoundingClientRect(),n=c.x-s.x;t.resize_object.maxWidth=c.width+n},this.resize_object.left_drag=function(r){if(!t.resize_object.active)return!1;var i;r.stopPropagation(),r.preventDefault(),"touchmove"===r.type?(i=r.touches[0].clientX,r.touches[0].clientY):(i=r.clientX,r.clientY);var a=-1*(i-t.resize_object.posX),s=t.data.crop_box_width+a,c=Math.max(2,Math.min(s,t.resize_object.maxWidth));e.style.width=c+"px",o.style.width=e.style.width,e.style.left=t.resize_object.left-(c-t.data.crop_box_width)+"px",o.style.left=e.style.left},this.resize_object.left_drag_end=function(o){o.stopPropagation(),o.preventDefault();var r=t.canvas.getBoundingClientRect();t.resize_object.active=!1,t.data.crop_box_width=parseFloat(e.style.width),t.data.crop_box_height=parseFloat(e.style.height),t.data.crop_box_width_perc=100*t.data.crop_box_width/r.width,t.data.crop_box_height_perc=100*t.data.crop_box_height/r.height;var i=parseFloat(e.style.top)||0,a=parseFloat(e.style.left)||0;t.data.crop_box_x_perc=100*a/r.width,t.data.crop_box_y_perc=100*i/r.height,"ontouchstart"in document.documentElement?(document.removeEventListener("touchend",t.resize_object.left_drag_end,{capture:!1,passive:!1}),document.removeEventListener("touchmove",t.resize_object.left_drag,{capture:!1,passive:!1}),document.addEventListener("touchstart",t.drag_object.drag_start,{capture:!1,passive:!1})):(document.removeEventListener("mouseup",t.resize_object.left_drag_end,{capture:!1,passive:!1}),document.removeEventListener("mousemove",t.resize_object.left_drag,{capture:!1,passive:!1}),document.addEventListener("mousedown",t.drag_object.drag_start,{capture:!1,passive:!1}))},"ontouchstart"in document.documentElement?document.addEventListener("touchstart",this.resize_object.left_drag_start,{capture:!1,passive:!1}):document.addEventListener("mousedown",this.resize_object.left_drag_start,{capture:!1,passive:!1})},Croppa.prototype.destroy=function(){this.drag_object&&("ontouchstart"in document.documentElement?document.removeEventListener("touchstart",this.drag_object.drag_start,{capture:!1,passive:!1}):document.removeEventListener("mousedown",this.drag_object.drag_start,{capture:!1,passive:!1})),this.resize_object&&("ontouchstart"in document.documentElement?(document.removeEventListener("touchstart",this.resize_object.tl_drag_start,{capture:!1,passive:!1}),document.removeEventListener("touchstart",this.resize_object.tr_drag_start,{capture:!1,passive:!1}),document.removeEventListener("touchstart",this.resize_object.bl_drag_start,{capture:!1,passive:!1}),document.removeEventListener("touchstart",this.resize_object.br_drag_start,{capture:!1,passive:!1}),document.removeEventListener("touchstart",this.resize_object.top_drag_start,{capture:!1,passive:!1}),document.removeEventListener("touchstart",this.resize_object.right_drag_start,{capture:!1,passive:!1}),document.removeEventListener("touchstart",this.resize_object.bottom_drag_start,{capture:!1,passive:!1}),document.removeEventListener("touchstart",this.resize_object.left_drag_start,{capture:!1,passive:!1})):(document.removeEventListener("mousedown",this.resize_object.tl_drag_start,{capture:!1,passive:!1}),document.removeEventListener("mousedown",this.resize_object.tr_drag_start,{capture:!1,passive:!1}),document.removeEventListener("mousedown",this.resize_object.bl_drag_start,{capture:!1,passive:!1}),document.removeEventListener("mousedown",this.resize_object.br_drag_start,{capture:!1,passive:!1}),document.removeEventListener("mousedown",this.resize_object.top_drag_start,{capture:!1,passive:!1}),document.removeEventListener("mousedown",this.resize_object.right_drag_start,{capture:!1,passive:!1}),document.removeEventListener("mousedown",this.resize_object.bottom_drag_start,{capture:!1,passive:!1}),document.removeEventListener("mousedown",this.resize_object.left_drag_start,{capture:!1,passive:!1}))),this.container.el.remove(),this.image.onload=null,this.data.resize_handler&&jQuery(window).off("resize",this.data.resize_handler)};